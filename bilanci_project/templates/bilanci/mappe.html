<!DOCTYPE html>
<html>
  <head>
    <title>Mappe OpenBilanci</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://www.openbilanci.it/static/img/favicon.ico" />

    <style>
      html, body, #map {
        height: 97%;
        padding: 0;
        margin: 0;
      }
    </style>

    <style type="cartocss/text" id="choropleth">
        /** choropleth visualization */

        #ob_ind_voci_2013_merge{
          polygon-fill: #dedede;
          polygon-opacity: 0.8;
          line-color: #000;
          line-width: 0.05;
          line-opacity: 1;
        }
        
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 8000] {
         polygon-fill: #d73027;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 1500] {
         polygon-fill: #f79272;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 900] {
         polygon-fill: #fed6b0;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 750] {
         polygon-fill: #fff2cc;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 500] {
         polygon-fill: #d2ecb4;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 350] {
         polygon-fill: #8cce8a;
        }
        #ob_ind_voci_2013_merge [ imposte_e_tasse <= 250] {
         polygon-fill: #1a9850;
        } 
    </style>

    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
  </head>
  <body>
    <div id="map"></div>

    <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>

    <script>

    window.onload = function() {
      var tableName = "ob_ind_voci_2013_merge";

      // Put layer data into a JS object
      var layerSource = {
              user_name: 'openpolis', 
              type: 'cartodb',
              sublayers: [{ 
                  sql: "SELECT * FROM " + tableName, // All recorded earthquakes past 30 days
                  cartocss: $("#choropleth").text() // Simple visualization
              }]
          }

      // For storing the sublayer
      var sublayer;

      // Instantiate new map object, place it in 'map' element
      var map_object = new L.Map('map', {
          center: [41.900,12.483], // Italy
          zoom: 6
      });

      L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map_object);

      // Add data layer to your map
      cartodb.createLayer(map_object,layerSource)
          .addTo(map_object)
          .done(function(layer) {
              sublayer = layer.getSubLayer(0);
          })
          .error(function(err) {
              console.log("error: " + err);
          });   

      $('#map .cartodb-logo').remove();
    }
    </script>

  </body>
</html>
