{%  extends "bilanci/bilancio_base.html" %}
{% load staticfiles %}
{% load section_title %}
{% load section_values_type %}
{% load chi_guadagna_perde %}
{% load popover_info %}


{% block page_title %}
    Bilancio {{ tipo_bilancio }} per il Comune di {{ territorio }}, anno {{ selected_year }}
{% endblock %}


{% block bilanci_content %}

    <div class="row" style="margin-top: 15px;">
        <div class="col-md-12">
            {% if tipo_bilancio == "consuntivo" %}
                {% section_values_type cas_com_type=cas_com_type values_type=values_type tooltip=True %}
            {% else %}
                {% section_values_type values_type=values_type tooltip=True %}
            {% endif %}
            <h3 style="margin-top: 0; font-size: 18px;">
                {% section_title bold_text="BILANCIO" main_bilancio_type=tipo_bilancio main_bilancio_year=selected_year comparison_bilancio_type=comparison_bilancio_type comparison_bilancio_year=comparison_bilancio_year %}
            </h3>
        </div>
    </div>

    <div class="row" >
        <div class="col-md-12">
           Qual è la politica di chi amministra il Comune? Quali sono le sue priorità?<br/>
Fai click sulla bolla per vedere la composizione delle Entrate e delle Spese e come si distribuiscono
            <span style="font-weight: bold; color:#7d8e17">GLI AUMENTI</span> e in alto,
            e <span style="font-weight: bold; color:#9b2d1b">LE RIDUZIONI</span> e in basso. {% popover_info 'widget-bilancio' %}
        </div>
    </div>


    <div class="tab-content composition-widget-container">
        <iframe class="composition-widget" frameborder='0' style="width: 100%;height: 722px;"
                src="{% url 'composition-widget' widget_type='overview' territorio_slug=territorio.slug bilancio_year=selected_year bilancio_type=tipo_bilancio %}?values_type={{ values_type }}&cas_com_type={{ cas_com_type }}"></iframe>
    </div>

    <div id="balance" class="row">
        <div class="col-md-12">
            <h3><strong>CHI GUADAGNA E CHI PERDE DI PIÙ NEL BILANCIO {{ tipo_bilancio|upper }} {{ selected_year }} </strong>
                <br class="hidden-lg">&nbsp;A CONFRONTO CON IL {{ comparison_bilancio_type|upper }} {{ comparison_bilancio_year }}
            </h3>
            <div class="row">
                <div class="col-sm-6"><h4>ENTRATE</h4></div>
                <div class="col-sm-6"><h4>SPESE</h4></div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        {% chi_guadagna_perde voce_set=entrate_chiguadagna type="guadagna" %}
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        {% chi_guadagna_perde voce_set=spese_chiguadagna type="guadagna" %}
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        {% chi_guadagna_perde voce_set=entrate_chiperde type="perde" %}
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        {% chi_guadagna_perde voce_set=spese_chiperde type="perde" %}
                    </div>
                </div>
            </div>

        </div>
    </div> <!-- /#balance -->

{% endblock %}

{% block extra_js_inner %}


    <!-- Initialization for year/budget type selector and linecharts -->
    <script type="text/javascript">
        $(document).ready(function(){

            /*
            * initialize year selectors
            * */

            var selector_init_obj ={
                'selector_default_year':{{ selector_default_year }},
                'selected_year':{{ selected_year }},
                'visible_buttons': true,
                'selected_bilancio_type': "{{ selected_bilancio_type }}",
                'start_year': {{ timeline_start_year }},
                'end_year': {{ timeline_end_year }},
                'reference_url': "{% url "bilanci-overview" slug=territorio.slug %}?year={{ selected_year }}&type={{ selected_bilancio_type }}"
            };


            init_selector(selector_init_obj);
            {#  starts sindaci timeline           #}
            init_main_linechart({{ timeline_start_year }},{{ timeline_end_year }},"EURO","EURO", false);
            feed_main_linechart();
            });

        function feed_main_linechart(){
            d3.json("{% url 'incarichi-voce-json' territorio_opid=territorio_opid voce_slug='preventivo-entrate' %}" +
                    "?values_type={{ values_type }}",
                    function (i) {
                linechart.data(i)
                {#  selectes the considered yr in the sindaci timeline   #}
                linechart.year({{ selected_year }});
            });

        }


    </script>

{% endblock %}

